using Content.Shared.Audio.Jukebox;
using Robust.Client.AutoGenerated;
using Robust.Client.UserInterface.XAML;
using Robust.Client.UserInterface.Controls;
using Robust.Shared.Prototypes;

namespace Content.Client.Audio.Jukebox;

[GenerateTypedNameReferences]
public sealed partial class JukeboxEntry : BoxContainer
{
    [Dependency] private readonly IEntityManager _entManager = default!;

    private JukeboxPrototype? _song;

    private Type _entryType;
    public Type EntryType
    {
        get {return _entryType;}
        set {
            _entryType = value;
            Buttons();
        }
    }

    public JukeboxEntry()
    {
        RobustXamlLoader.Load(this);
        IoCManager.InjectDependencies(this);

        Buttons();
    }

    public JukeboxEntry(JukeboxPrototype? song) : this()
    {
        SetSong(song);
        Buttons();
    }

    public void SetSong(JukeboxPrototype? song)
    {
        _song = song;

        if (song == null)
        {
            Buttons();
            return;
        }

        SongName.Text = song.Name;

        Buttons();
    }

    public void SetOnPressedPlay(Action<JukeboxPrototype?, BaseButton.ButtonEventArgs>? func)
    {
        if (func == null)
            return;

        PlayButton.OnPressed += args => {
            func(_song, args);
        };
    }

    public void SetOnPressedQueue(Action<JukeboxPrototype?, BaseButton.ButtonEventArgs>? func)
    {
        if (func == null)
            return;

        QueueButton.OnPressed += args => {
            func(_song, args);
        };
    }

    public void SetOnPressedStop(Action<BaseButton.ButtonEventArgs>? func)
    {
        StopButton.OnPressed += func;
    }

    public void SetOnPressedRemove(Action<JukeboxEntry, BaseButton.ButtonEventArgs>? func)
    {
        if (func == null)
            return;

        RemoveButton.OnPressed += args => {
            func(this, args);
        };
    }

    private void Buttons()
    {
        PlayButton.Visible = _song != null && (_entryType == Type.List || _entryType == Type.Current);
        StopButton.Visible = _song != null && _entryType == Type.Current;
        RemoveButton.Visible = _song != null && _entryType == Type.Queue;
        QueueButton.Visible = _song != null && _entryType == Type.List;
    }

    public enum Type
    {
        List,
        Queue,
        Current,
    }
}

